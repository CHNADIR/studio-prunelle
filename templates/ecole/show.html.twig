{% extends 'base.html.twig' %}

{% block title %}Fiche École: {{ ecole.nom }}{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Fiche École: {{ ecole.nom }}</h1>
        <a href="{{ path('app_ecole_index') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Retour à la liste
        </a>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            Informations Générales
        </div>
        <div class="card-body">
            <table class="table table-borderless table-sm">
                <tbody>
                    <tr>
                        <th style="width: 20%;">Code</th>
                        <td>{{ ecole.code }}</td>
                    </tr>
                    <tr>
                        <th>Genre</th>
                        <td>{{ ecole.genre }}</td>
                    </tr>
                    <tr>
                        <th>Nom</th>
                        <td>{{ ecole.nom }}</td>
                    </tr>
                    <tr>
                        <th>Adresse</th>
                        <td>{{ ecole.rue }}, {{ ecole.codePostal }} {{ ecole.ville }}</td>
                    </tr>
                    <tr>
                        <th>Téléphone</th>
                        <td>{{ ecole.telephone|default('N/A') }}</td>
                    </tr>
                    <tr>
                        <th>Email</th>
                        <td>{{ ecole.email|default('N/A') }}</td>
                    </tr>
                    <tr>
                        <th>Statut</th>
                        <td>
                            <span class="badge {{ ecole.active ? 'bg-success' : 'bg-danger' }}">
                                {{ ecole.active ? 'Active' : 'Inactive' }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    {% if ecole.prisesDeVue is defined and ecole.prisesDeVue|length > 0 %}
    <div class="card mb-4">
        <div class="card-header">
            Dernières Prises de Vue
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover table-sm">
                    <thead class="table-light">
                        <tr>
                            <th>Date</th>
                            <th>Type de Prise</th>
                            <th>Thème</th>
                            <th>Photographe</th>
                            <th>Nb Élèves</th>
                            <th>Prix École</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pdv in ecole.prisesDeVue|slice(0, 5) %}
                            <tr>
                                <td>{{ pdv.date ? pdv.date|date('d/m/Y') : '' }}</td>
                                <td>{{ pdv.typePrise ? pdv.typePrise.name : 'N/A' }}</td>
                                <td>{{ pdv.theme ? pdv.theme.name : 'N/A' }}</td>
                                <td>{{ pdv.photographe ? pdv.photographe.email : 'N/A' }}</td>
                                <td>{{ pdv.nombreEleves|default('N/A') }}</td>
                                <td>{{ pdv.prixEcole ? pdv.prixEcole|number_format(2, ',', ' ') ~ ' €' : 'N/A' }}</td>
                                <td>
                                    {% if is_granted('ROLE_RESPONSABLE_ADMINISTRATIF') or (is_granted('ROLE_PHOTOGRAPHE') and app.user == pdv.photographe) %}
                                        <a href="{{ path('app_prise_de_vue_show', {'id': pdv.id}) }}" class="btn btn-sm btn-outline-primary" title="Voir détail PDV"><i class="bi bi-search"></i></a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="mt-3 d-flex justify-content-between">
        <a href="{{ path('app_ecole_index') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left-circle"></i> Retour à la liste
        </a>
        {% if is_granted('ROLE_RESPONSABLE_ADMINISTRATIF') %}
            <div>
                <a href="{{ path('app_ecole_edit', {'id': ecole.id}) }}" class="btn btn-warning me-2">
                    <i class="bi bi-pencil"></i> Modifier l'école
                </a>
                {{ include('ecole/_delete_form.html.twig') }}
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
